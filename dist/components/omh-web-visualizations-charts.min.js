!function(e,t){var a="OMHWebVisualizations";e[a]=t(e,a),e[a].QUANTIZE_YEAR=6,e[a].QUANTIZE_MONTH=5,e[a].QUANTIZE_DAY=4,e[a].QUANTIZE_HOUR=3,e[a].QUANTIZE_MINUTE=2,e[a].QUANTIZE_SECOND=1,e[a].QUANTIZE_MILLISECOND=0,e[a].QUANTIZE_NONE=-1,e[a].Utils={},e[a].Utils.mergeObjects=function(t,n){function i(i){if(void 0===o[i]){var r=t[i],s=n[i];typeof r==typeof s&&"object"==typeof r?o[i]=e[a].Utils.mergeObjects(r||{},s||{}):(o[i]=r,n.hasOwnProperty(i)&&(o[i]=s))}}var o={};for(var r in t)i(r);for(r in n)i(r);return o}}(this,function(e,t){var a=e.hasOwnProperty(t)?e[t]:{};return a.Chart=function(e,t,n,o){var r=864e5,s=.5,l="1px",u="1px";this.initialized=!1,"function"==typeof jQuery&&t instanceof jQuery&&(t=t[0]),t.node||(t=d3.select(t)),o||(o={});var m=null;t.classed("omh-chart-container",!0);var c=null,d=n.split(/\s*,\s*/),h={},f={},p=null,v=null,b={userInterface:{toolbar:{enabled:!0},timespanButtons:{enabled:!0},zoomButtons:{enabled:!0},navigation:{enabled:!0},thresholds:{show:!0},tooltips:{enabled:!0,timeFormat:"M/D/YY, h:mma",decimalPlaces:0,contentFormatter:void 0,grouped:!0},panZoom:{enabled:!0,showHint:!0},axes:{yAxis:{visible:!0},xAxis:{visible:!0}}},measures:{body_weight:{valueKeyPath:"body.body_weight.value",range:{min:0,max:100},units:"kg",thresholds:{max:57}},heart_rate:{valueKeyPath:"body.heart_rate.value",range:{min:30,max:150},units:"bpm"},step_count:{valueKeyPath:"body.step_count",range:{min:0,max:1500},units:"Steps",seriesName:"Steps",timeQuantizationLevel:a.QUANTIZE_DAY,chart:{type:"clustered_bar",barColor:"#eeeeee",daysShownOnTimeline:{min:7,max:90}}},minutes_moderate_activity:{valueKeyPath:"body.minutes_moderate_activity.value",range:{min:0,max:300},units:"Minutes",seriesName:"Minutes of moderate activity",timeQuantizationLevel:a.QUANTIZE_DAY,chart:{type:"clustered_bar",daysShownOnTimeline:{min:7,max:90}}},systolic_blood_pressure:{valueKeyPath:"body.systolic_blood_pressure.value",range:{min:30,max:200},units:"mmHg",thresholds:{max:120}},diastolic_blood_pressure:{valueKeyPath:"body.diastolic_blood_pressure.value",range:{min:30,max:200},units:"mmHg",thresholds:{max:80}}}},g={range:{min:0,max:100},units:"Units",seriesName:"Series",timeQuantizationLevel:a.QUANTIZE_NONE,chart:{type:"line",pointSize:9,lineColor:"#dedede",pointFillColor:"#4a90e2",pointStrokeColor:"#0066d6",aboveThesholdPointFillColor:"#e8ac4e",aboveThesholdPointStrokeColor:"#745628",barColor:"#4a90e2",daysShownOnTimeline:{min:1,max:1e3}}};this.destroy=function(){Ze&&Ze.offPointerMove(Qe),Ze&&Ze.detachFrom(W),M&&M.detachFrom(p),p&&p.destroy(),Le&&Le.destroy(),v&&v.offWheel(S),ke&&M.offDrag(ke),_e&&_e.remove(),I&&E.offUpdate(I)},this.getComponents=function(){if(!this.initialized)return{};var e={};e[d[0]]=E;var t={};t[d[0]]=C;var a={};a[d[0]]=O;var n={};n[d[0]]=P;var i={};i[d[0]]=N;var o={};return o[d[0]]=q,V.forEach(function(n){e[n.measure]=n.scale,t[n.measure]=n.axis,a[n.measure]=n.label}),{xScales:n,yScales:e,colorScales:o,gridlines:null,legends:[J],xAxes:i,yAxes:t,plots:k,yLabels:a,table:p,tooltip:Le,toolbar:_e,panZoomInteractions:{plotGroup:ce,xAxis:de}}},this.getD3Selection=function(){return m};var y=a.Utils.mergeObjects(b,o);d3.keys(y.measures).forEach(function(e){y.measures[e]=a.Utils.mergeObjects(g,y.measures[e])});var x=y.userInterface,_=function(e){return y.measures[e]},D={},T=function(e,t){if(void 0===e)return e;var a;"string"==typeof t?(D[t]||(D[t]=t.split(".")),a=D[t].slice()):a=t;try{if(t&&a.length>0)return T(e[a.shift()],a)}catch(n){console.info("Exception while resolving keypath",n)}return e};if(this.getIntervalDisplayDate=function(e,t,a){var n=e.body.effective_time_frame.time_interval,i=n.start_date_time?new Date(n.start_date_time).getTime():null,o=n.end_date_time?new Date(n.end_date_time).getTime():null,r=n.start_date_time?t(n.start_date_time):null,s=n.end_date_time?t(n.end_date_time):null,l={ps:1e-9,ns:1e-6,us:.001,ms:1,sec:1e3,min:6e4,h:36e5,d:"d",wk:"w",Mo:"M",yr:"y"},u=n.duration?n.duration.value:null;if(u){var m,c=n.duration.unit,d=l[c];"string"!=typeof d?(m=u*d,i||(i=o-m),o||(o=i+m)):(i||(i=s.subtract(u,l[c]).valueOf()),o||(o=r.add(u,l[c]).valueOf()))}var h=new Date(i),f=a<=OMHWebVisualizations.QUANTIZE_MONTH?h.getMonth():6,p=a<=OMHWebVisualizations.QUANTIZE_DAY?h.getDate():a===OMHWebVisualizations.QUANTIZE_MONTH?15:1,v=a<=OMHWebVisualizations.QUANTIZE_HOUR?h.getHours():a===OMHWebVisualizations.QUANTIZE_DAY?12:0,b=a<=OMHWebVisualizations.QUANTIZE_MINUTE?h.getMinutes():a===OMHWebVisualizations.QUANTIZE_HOUR?30:0,g=a<=OMHWebVisualizations.QUANTIZE_SECOND?h.getSeconds():a===OMHWebVisualizations.QUANTIZE_MINUTE?30:0,y=a<=OMHWebVisualizations.QUANTIZE_MILLISECOND?h.getMilliseconds():a===OMHWebVisualizations.QUANTIZE_SECOND?500:0,x=new Date(h.getFullYear(),f,p,v,b,g,y);return x},this.parseOmhData=function(e,t,a){var n={},i=this;return e&&0!==e.length?(e.forEach(function(e){e.groupName="",t.forEach(function(t,o){var r=_(t).valueKeyPath,s=T(e,r);if(void 0!==s&&"object"!=typeof s){e.groupName+="_"+t,n.hasOwnProperty(t)||(n[t]=[]);var l;if(e.body.effective_time_frame.date_time&&(l=new Date(e.body.effective_time_frame.date_time)),e.body.effective_time_frame.time_interval){var u=_(t).timeQuantizationLevel;l=i.getIntervalDisplayDate(e,a,u)}var m=_(t).valueKeyPath,c=T(e,m);n[t].push({y:c,x:l,provider:e.header.acquisition_provenance.source_name,omhDatum:e,hasTooltip:0===o,measure:t})}})}),n):n},dataCopy=JSON.parse(JSON.stringify(e)),c=this.parseOmhData(dataCopy,d,moment),0===Object.keys(c).length)return void console.log("Warning: no data of the specified type could be found.");this.consolidateData=function(e){e.sort(function(e,t){return e.x.getTime()-t.x.getTime()});for(var t=0;t<e.length;t++)for(;t+1<e.length&&e[t+1].x.getTime()===e[t].x.getTime();)e[t].y+=e[t+1].y,e[t].accumulatedDataBodies||(e[t].accumulatedDataBodies=[e[t].omhDatum.body]),e[t].accumulatedDataBodies.push(e[t+1].omhDatum.body),e.splice(t+1,1)},c.minutes_moderate_activity&&this.consolidateData(c.minutes_moderate_activity),c.step_count&&this.consolidateData(c.step_count);var w=_(d[0]),P=new Plottable.Scales.Time,E=new Plottable.Scales.Linear,I=null,A=w.range;A&&E.domainMin(A.min).domainMax(A.max);var N=new Plottable.Axes.Time(P,"bottom").margin(15).addClass("x-axis"),C=new Plottable.Axes.Numeric(E,"left"),O=new Plottable.Components.AxisLabel(w.units,"0").padding(5).xAlignment("right").yAlignment("top"),M=new Plottable.Interactions.Drag,U=function(){te&&te(),Le&&ke&&ke()};M.onDrag(U);var S=function(){ke&&ke(),xe&&xe(),te&&te()},k=[],z=function(e){var t=_(e.measure).thresholds,a={name:"normal",color:"_default"};if(!t||0==t.length)return a;for(Array.isArray(t)||(t=[t]),i=0;i<t.length;i++){var n=t[i];if(n&&(!n.max||e.y<=n.max)&&(!n.min||e.y>n.min))return n}return{color:"_aboveThreshold",name:"above-threshold"}},Z=function(e,t){var a=_(e.measure).chart,n={fill:a.pointFillColor,stroke:a.pointStrokeColor},i={fill:a.aboveThesholdPointFillColor,stroke:a.aboveThesholdPointStrokeColor};return t&&t.color?"_default"==t.color?n:"_aboveThreshold"==t.color?i:"string"==typeof t.color?{fill:t.color,stroke:t.color}:t.color:n},Q=function(e){var t=Z(e,z(e));return t.fill},H=function(e){var t=Z(e,z(e));return t.stroke},L=function(e){return _(e.measure).chart.barColor},W=(new Plottable.Plots.Scatter).x(function(e){return e.x},P).y(function(e){return e.y},E).size(function(e){return _(e.measure).chart.pointSize}).attr("fill",function(e){return Q(e)}).attr("opacity",s).attr("stroke-width",u).attr("stroke",function(e){return H(e)}),F=[],B=0,V=[];if(d3.entries(c).forEach(function(e){var t=e.key;"clustered_bar"===_(t).chart.type&&B++}),x.thresholds.show){var R=[];if(d3.entries(c).forEach(function(e){measure=e.key;var t=_(measure).thresholds;if(t)for(Array.isArray(t)||(t=[t]),i=0;i<t.length;i++){var a=t[i];a.max&&-1==R.indexOf(a.max)&&R.push(a.max),a.min&&-1==R.indexOf(a.min)&&R.push(a.min)}}),R.length>0){R.sort(function(e,t){return e-t});var j=new Plottable.Scales.Linear;j.domain(E.domain()),j.range(E.range()),I=function(e){j.domain(e.domain()),j.range(e.range())},E.onUpdate(I);var Y=function(e){var t=(e.domain(),R);return t};j.tickGenerator(Y);var K=new Plottable.Axes.Numeric(j,"right").tickLabelPosition("top").tickLabelPadding(5).showEndTickLabels(!0),G=new Plottable.Components.Gridlines(null,j);k.push(G),k.push(K)}}d.forEach(function(e){if(c.hasOwnProperty(e)){var t=c[e],a=new Plottable.Dataset(t),n=_(e);if(a.measure=e,"clustered_bar"===n.chart.type){var i=E;if(F.length>0){var o=n.range,r=n.units;i=(new Plottable.Scales.Linear).domainMin(o.min).domainMax(o.max);var s=new Plottable.Axes.Numeric(i,"right"),u=new Plottable.Components.AxisLabel(r,"0").padding(5).xAlignment("left").yAlignment("top");V.push({measure:e,axis:s,label:u,scale:i})}var m=(new Plottable.Plots.ClusteredBar).x(function(e){return e.x},P).y(function(e){return e.y},i).attr("fill",function(e){return L(e)});F.push(m);for(var d=0;B>d;d++)d===F.length-1?m.addDataset(a):m.addDataset(new Plottable.Dataset([]));var h=N.axisConfigurations(),f=[];h.forEach(function(e){("day"===e[0].interval||"month"===e[0].interval||"year"===e[0].interval)&&f.push(e)}),N.axisConfigurations(f),k.push(m)}else{var p=(new Plottable.Plots.Line).x(function(e){return e.x},P).y(function(e){return e.y},E).attr("stroke",n.chart.lineColor).attr("stroke-width",l);p.addDataset(a),W.addDataset(a),k.push(p)}}}),k.push(W);var q=null,J=null;if(y.userInterface.legend){q=new Plottable.Scales.Color,J=new Plottable.Components.Legend(q);var X=[],$=[];d3.entries(c).forEach(function(e){var t,a=e.key,n=_(a),i=n.seriesName,o=n.chart.type;switch(o){case"clustered_bar":t=n.chart.barColor;break;default:t=n.chart.pointFillColor}i&&t&&(X.push(i),$.push(t))}),q.domain(X),q.range($),J.maxEntriesPerRow(2),J.symbol(Plottable.SymbolFactories.square),J.xAlignment("right"),J.yAlignment("top"),k.push(J)}if(x.panZoom.enabled&&x.panZoom.showHint){var ee=new Plottable.Components.Label("( Drag chart to pan, pinch or scroll to zoom )",0).padding(10).yAlignment("bottom").xAlignment("right").addClass("zoom-hint-label"),te=((new Plottable.Interactions.Click).attachTo(ee).onClick(function(e){te()}),function(){ee.addClass("hidden")});k.push(ee)}var ae=x.axes.xAxis.visible,ne=x.axes.yAxis.visible,ie=new Plottable.Components.Group(k),oe=ne?new Plottable.Components.Group([C,O]):null,re=[oe,ie],se=[null,ae?N:null];ne&&V.forEach(function(e){re.push(new Plottable.Components.Group([e.axis,e.label])),se.push(null)}),p=new Plottable.Components.Table([re,se]),p.yAlignment("bottom"),M.attachTo(p);var le=w.chart.daysShownOnTimeline,ue=le?le.min:!1,me=le?le.max:!1,ce=null,de=null;if(x.panZoom.enabled&&(ce=new Plottable.Interactions.PanZoom,ce.addXScale(P),ce.attachTo(ie),de=new Plottable.Interactions.PanZoom,de.addXScale(P),de.attachTo(N),ue&&(ce.minDomainExtent(P,ue*r),de.minDomainExtent(P,ue*r)),me&&(ce.maxDomainExtent(P,me*r),de.maxDomainExtent(P,me*r))),me){var he=[];d3.entries(c).forEach(function(e){var t=e.value;t.forEach(function(e){he.push(e.x)})});var fe=P.extentOfValues(he),pe=fe[1].getTime()-fe[0].getTime(),ve=me*r;pe>ve&&(fe[1]=new Date(fe[0].getTime()+ve)),P.domain(fe)}var be=function(e){ue&&(e=Math.max(e,ue)),me&&(e=Math.min(e,me));var t=P.domain(),a=[t[0],new Date(t[0].getTime()+e*r)];P.domain(a)},ge=function(e){var t=P.domain();timeInDays=(t[1].getTime()-t[0].getTime())/r,timeInDays*=(100-e)/100,ue&&(timeInDays=Math.max(timeInDays,ue)),me&&(timeInDays=Math.min(timeInDays,me));var a=[t[0],new Date(t[0].getTime()+timeInDays*r)];P.domain(a)},ye=function(e){var t=P.domain();timeInDays=(t[1].getTime()-t[0].getTime())/r,timeInDays*=e/100;var a=[new Date(t[0].getTime()+timeInDays*r),new Date(t[1].getTime()+timeInDays*r)];P.domain(a)},xe=function(){d3.selectAll(".time-button").classed("active",!1)},_e=null;if(x.toolbar.enabled){if(_e=t.append("div").classed("omh-chart-toolbar",!0).attr("unselectable","on"),x.timespanButtons.enabled){var De={"1wk":7,"1m":30,"3m":90,"6m":180};_e.append("span").classed("time-buttons-label",!0).text("Show: "),d3.entries(De).forEach(function(e){var t=e.value,a=e.key;if((!me||me>=t)&&(!ue||t>=ue)){var n=_e.append("span").classed("time-button",!0).text(a);n.on("click",function(){xe(),be(t),d3.select(this).classed("active",!0)})}})}if(x.zoomButtons.enabled){var Te={"&#8722;":-20,"&#43;":20};_e.append("span").classed("zoom-buttons-label",!0).text(" Zoom: "),d3.entries(Te).forEach(function(e){var t=e.value,a=e.key,n=_e.append("span").classed("zoom-button",!0).html(a);n.on("click",function(){xe(),ge(t)})})}if(x.navigation.enabled){var we=_e.append("span",":first-child").classed("previous-time-period-button",!0).text("< prev");we.on("click",function(){ye(-100)});var Pe=_e.append("span").classed("next-time-period-button",!0).text("next >");Pe.on("click",function(){ye(100)})}}var Ee=W.datasets(),Ie=Ee&&Ee.length>0;if(x.tooltips.enabled&&Ie){var Ae=null,Ne=function(e){e.selection.style("opacity","1")},Ce=function(e){e.selection.style("opacity",s)},Oe=function(e,t){f[e][t].forEach(function(e){Ne(e)})},Me=function(e,t){f[e][t].forEach(function(e){Ce(e)})},Ue=function(e){Le.show(e.datum,e.selection[0][0])},Se=function(e){e&&m&&(e.selection[0][0].getBoundingClientRect().left>m[0][0].getBoundingClientRect().left&&e.selection[0][0].getBoundingClientRect().right<m[0][0].getBoundingClientRect().right?Ue(e):Le.hide())},ke=function(){if(Ae&&m)if(Ae.datum.hasTooltip||!x.tooltips.grouped)Se(Ae);else{var e=h[Ae.datum.omhDatum.groupName][Ae.index],t=d3.select(".d3-tip").node().clientHeight;Se(e.selection[0][0].getBoundingClientRect().top>m[0][0].getBoundingClientRect().top+t?e:Ae)}},ze=function(e){if(null!==Ae){var t=x.tooltips.grouped,a=e.datum.omhDatum.body!==Ae.datum.omhDatum.body,n=e.datum.measure!==Ae.datum.measure,i=t?a:a||n;i&&(Me(Ae.datum.omhDatum.groupName,Ae.index),Ae=e,Oe(Ae.datum.omhDatum.groupName,e.index))}else Ae=e;null===e.datum},Ze=new Plottable.Interactions.Pointer;Ze.onPointerExit(function(e){Le.hide()}),Ze.onPointerEnter(ke.bind(this));var Qe=function(e){var t;try{t=W.entityNearest(e),ze(t),ke()}catch(a){return}}.bind(this);Ze.onPointerMove(Qe),Ze.attachTo(W);var He=function(e,t){var a,n="value",i=z(e);if(i&&(i.cssClass||i.name)){var o=i.cssClass?i.cssClass:i.name;o=o.toLowerCase().replace(/[^a-z0-9-]+/g,"_"),n+=" threshold-"+o+" threshold-"+e.measure+"-"+o}var r;if(y.userInterface.tooltips&&"undefined"!=typeof y.userInterface.tooltips.contentFormatter)r=y.userInterface.tooltips.contentFormatter(e);else{var s="undefined"!=typeof y.userInterface.decimalPlaces?y.userInterface.decimalPlaces:1;r=e.y.toFixed(s)}a='<div class="'+n+'">'+r+"</div>";var l=x.tooltips.timeFormat;return a+='<div class="time">'+moment(e.x).format(l)+"</div>",a+='<div class="provider">'+e.provider+"</div>"},Le=d3.tip().attr("class","d3-tip").html(function(e){return'<div class="omh-tooltip">'+He(e,n)+"</div>"})}this.renderTo=function(e){return this.initialized?(m=d3.select(e),Le&&m.call(Le),v&&v.offWheel(S),v=new Plottable.Dispatchers.Mouse.getDispatcher(m[0][0]).onWheel(S),p.renderTo(m),h={},f={},void W.entities().forEach(function(e){var t=e.datum.omhDatum.groupName;h[t]||(h[t]=[]),e.datum.hasTooltip&&(h[t][e.index]=e),f[t]||(f[t]=[]),f[t][e.index]||(f[t][e.index]=[]),f[t][e.index].push(e)})):void console.log("Warning: chart could not be rendered because it was not successfully initialized.")},this.initialized=!0},a});